
{
	"name": "storybook",
	"tags": ["tooling"],
	"namedInputs": {
		"core": [
			"{workspaceRoot}/assets",
			"{projectRoot}/*.js",
			"{projectRoot}/*.html",
			"{workspaceRoot}/components/*/stories",
			"{workspaceRoot}/components/*/dist"
		],
		"tools": []
	},
	"targets": {
		"build": {
			"dependsOn": ["^build", "clean"],
			"envFile": ".env.prod",
			"executor": "nx:run-commands",
			"inputs": ["core", { "externalDependencies": ["storybook"] }],
			"outputs": ["{projectRoot}/storybook-static"],
			"options": {
				"commands": [
					"storybook build --config-dir {projectRoot} --output-dir {projectRoot}/storybook-static"
				]
			},
			"configurations": {
				"ci": {
					"cache": false,
					"commands": [
						"storybook build --config-dir {projectRoot}"
					]
				}
			}
		},
		"clean": {},
		"format": {
			"inputs": [
				"core",
				{ "externalDependencies": ["stylelint", "eslint", "prettier"] }
			],
			"options": {
				"commands": [
					"stylelint {projectRoot}/storybook-*.css --fix",
					"eslint --no-error-on-unmatched-pattern {projectRoot}/*.js {projectRoot}/{package,project}.json ./components/*/stories/*.js --fix",
					"prettier --no-error-on-unmatched-pattern --write {projectRoot}/**/*.{js,json,yml,md} {projectRoot}/*.{js,json,yml,md}"
				]
			}
		},
		"lint": {
			"inputs": ["core", { "externalDependencies": ["stylelint", "eslint"] }],
			"options": {
				"commands": [
					"stylelint {projectRoot}/assets/*.css",
					"eslint --no-error-on-unmatched-pattern {projectRoot}/*.js {projectRoot}/{package,project}.json ./components/*/stories/*.js"
				]
			}
		},
		"start": {
			"cache": true,
			"dependsOn": ["^build"],
			"executor": "@nx/storybook:storybook",
			"inputs": [
				"core",
				{ "externalDependencies": ["storybook"] },
				{ "env": "WATCH_MODE" }
			],
			"options": {
				"configDir": "{projectRoot}",
				"open": true
			},
			"outputs": []
		},
		"test": {
			"cache": true,
			"inputs": [
				"core",
				{ "externalDependencies": ["chromatic", "storybook"] },
				{ "env": "CHROMATIC_PROJECT_TOKEN" }
			],
			"executor": "nx:run-commands",
			"options": {
				"cwd": "{projectRoot}",
				"commands": [
					"chromatic --only-changed --build-script-name build --junit-report --untraced .github/actions/*/package.json --untraced site/package.json --untraced generator/package.json"
				]
			},
			"configurations": {
				"scope": {
					"commands": [
						"chromatic --build-script-name build --junit-report --only-story-names"
					],
					"forwardAllArgs": true
				}
			}
		}
	}
}
